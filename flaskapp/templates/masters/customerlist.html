{% extends "base.html" %}
{% set page_title = "顧客一覧" %}

{% block content %}

  <!-- 上部：新規登録ボタン -->
  <div class="mb-4 d-flex justify-content-start">
    <a href="{{ url_for('customerlist.customer_new') }}"
       class="btn btn-primary new-btn"
       onclick="window.open(this.href, '_blank', 'width=1200,height=800'); return false;">
      新規登録
    </a>
  </div>

  {% import "ui/common_parts.html" as ui %}
  {% import "ui/search_buttons.html" as sc %}

  {% set th_list = [
    {"class": "col-select", "label": "選択"},
    {"class": "col-status", "label": "登録状況"},
    {"class": "col-code", "label": "顧客cd"},
    {"class": "col-customer", "label": "名前"},
    {"class": "col-customer", "label": "名前ｶﾅ"},
    {"class": "col-date", "label": "生年月日"}, 
    {"class": "col-type", "label": "区分"},
    {"class": "col-rank", "label": "ランク"},
    {"class": "col-date", "label": "登録日"}
  ] %}
  {% set colspan = th_list | length %}

  <!-- 検索フォーム -->
  <form method="get" class="mb-4 p-3 border rounded bg-light">
    <div class="row g-3">
      {# 各検索項目をBootstrapの列(column)に入れる #}
      <div class="col-md-4">
        {{ ui.search_input("顧客cd", "customer_code", filters.customer_code or "") }}
      </div>
      <div class="col-md-4">
        {{ ui.search_input("名前", "name", filters.name or "") }}
      </div>
      <div class="col-md-4">
        {{ ui.search_input("名前ｶﾅ", "name_kana", filters.name_kana or "") }}
      </div>
      <div class="col-md-4">
        {{ ui.search_input("電話番号", "tel", filters.tel or "") }}
      </div>
      <div class="col-md-4">
        {{ ui.search_input("勤務先", "workplace", filters.workplace or "") }}
      </div>
      <div class="col-md-4">
        {{ ui.search_input("登録状況", "registration_status", filters.registration_status or "") }}
      </div>
      <div class="col-md-6">
        {# 日付範囲の入力欄はBootstrapのインプットグループを使うと綺麗にまとまる #}
        <div class="input-group input-group-sm"> {# input-group-smを追加して全体を少し小さく #}
            <span class="input-group-text">登録日</span>
            <input type="date" name="registration_date_from" value="{{ filters.registration_date_from or '' }}" class="form-control" style="max-width: 150px;">
            <span class="input-group-text">～</span>
            <input type="date" name="registration_date_to" value="{{ filters.registration_date_to or '' }}" class="form-control" style="max-width: 150px;">
        </div>
      </div>
    </div>
    {{ sc.search_buttons("/masters/customerlist", selected_limit, page, total_pages, total) }}
  </form>

  <!-- 一覧テーブル -->
  <div class="table-responsive">
    <table class="table table-bordered table-sm customer-list-table">
      <thead style="position: sticky; top: 0; z-index: 2; background: #fff;">
        <tr>
          {% for th in th_list %}
            <th class="{{ th.class }}">{{ th.label }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% if customers %}
          {% for c in customers %}
            <tr>
              <td class="col-select text-center">
                <a href="{{ url_for('customerlist.customer_edit', customer_code=c.customer_code) }}"
                class="select-link"
                onclick="window.open(this.href, '_blank', 'width=1200,height=800'); return false;">
                選択
              </a>
              </td>
              <td class="col-status">
                {{ status_map.get(c.registration_status, '不明') }}
              </td>
              <td class="col-code">{{ c.customer_code or '' }}</td>
              <td class="col-customer">{{ c.name or '' }}</td>
              <td class="col-customer">{{ c.name_kana or '' }}</td>
              <td class="col-date">{{ c.individual_birthDate or '' }}</td>
              <td class="col-type">{{ c.typeofcustomer or '' }}</td>
              <td class="col-rank">{{ c.customer_rank or '' }}</td>
              <td class="col-date">{{ c.registration_date or '' }}</td>
            </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="{{ colspan }}" class="text-center text-muted">
              該当する顧客がありません。
            </td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>

{% endblock %}