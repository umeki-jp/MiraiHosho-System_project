{# ============================================================================== #}
{# マクロ1：承認・差戻しメッセージ表示用 #}
{# ============================================================================== #}
{% macro render_approval_messages(approval_request) %}
  {% if approval_request %}
    {# --- 差戻し(申請ステータス=2)の場合 --- #}
    {% if approval_request.status == 2 %}
      <div class="alert alert-danger mb-4" role="alert">
        <h5 class="alert-heading">差戻し</h5>
        {% if approval_request.request_type == '新規' %}
            <p class="mb-0">新規登録申請が差戻されました。内容を修正して再度、申請を行ってください。</p>
        {% elif approval_request.request_type == '更新' %}
            <p>更新申請が差戻されました。更新前の内容が表示されています。</p>
            <p class="mb-0">差戻された変更内容は以下の通りです。内容を修正して再度、申請を行ってください。</p>
            <hr>
            {% with changes=approval_request.changes %}{% include 'shared/_change_table.html' %}{% endwith %}
        {% elif approval_request.request_type == '削除' %}
            <p class="mb-0">削除申請が差戻されました。</p>
        {% endif %}
      </div>
    {# --- 承認待ち(申請ステータス=0)の場合 --- #}
    {% elif approval_request.status == 0 %}
      <div class="alert alert-warning mb-4" role="alert">
        <h5 class="alert-heading">承認待ち</h5>
        <p>この顧客情報は現在、以下の内容で承認待ちです。</p>
        <hr>
        <div class="row">
          <div class="col-md-5">
              <strong>申請種別:</strong> {{ approval_request.request_type }} <br>
              <strong>申請者:</strong> {{ approval_request.requester_name }} (ID: {{ approval_request.requester_id }})<br>
              <strong>承認者:</strong> {{ approval_request.approver_name }} (ID: {{ approval_request.approver_id }})
          </div>
          <div class="col-md-7">
              {% with changes=approval_request.changes %}{% include 'shared/_change_table.html' %}{% endwith %}
          </div>
        </div>
      </div>
    {% endif %}
  {% endif %}
{% endmacro %}


{# ============================================================================== #}
{# マクロ2：承認フローありの画面用のボタン #}
{# ============================================================================== #}
{% macro render_approval_buttons(mode, form_data, button_config, approval_request, approvers) %} {# ← approversを追加 #}
  {# --- 新規登録画面のボタン --- #}
  {% if mode == "create" %}
    {% if button_config.show_approval_register %}<button type="submit" name="action" value="request_new_approval" class="form-action-btn">登録申請</button>{% endif %}
    <button type="button" class="form-action-btn btn-negative" onclick="window.close();">登録せず閉じる</button>

  {# --- 編集画面のボタン --- #}
  {% else %}
    <input type="hidden" name="customer_code" value="{{ form_data.customer_code or '' }}">
    {% if approval_request %}<input type="hidden" name="approval_request_id" value="{{ approval_request.id }}">{% endif %}
    
    {# 承認待ち #}
    {% if form_data.registration_status == 2 %}
        {% if button_config.show_withdraw %}<button type="submit" name="action" value="withdraw_request" class="form-action-btn btn-warning">取下げ</button>{% endif %}
        {% if button_config.show_approve %}<button type="submit" name="action" value="approve" class="form-action-btn btn-success">承認する</button>{% endif %}
        {% if button_config.show_reject %}<button type="submit" name="action" value="reject" class="form-action-btn btn-danger">差戻し</button>{% endif %}
        <button type="button" class="form-action-btn btn-negative" onclick="window.close();">閉じる</button>
    {# 通常時（登録済、差戻しなど） #}
    {% else %}
        {% if button_config.show_approval_update %}<button type="submit" name="action" value="request_update_approval" class="form-action-btn">更新申請</button>{% endif %}
        <div class="vr mx-2"></div>
        {% if button_config.show_approval_delete %}<button type="submit" name="action" value="request_delete_approval" class="form-action-btn btn-negative">削除申請</button>{% endif %}
        <button type="button" class="form-action-btn btn-negative" onclick="window.close();">閉じる</button>
    {% endif %}
  {% endif %}
{% endmacro %}