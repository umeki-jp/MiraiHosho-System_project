{% macro search_buttons(base_url, selected_limit="20", page=1, total_pages=1, total=0) %}
 <div class="search-buttons-row">
  
  <!-- âœ… ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
  <div class="search-pagination">
    <span>ã€å…¨{{ total }}ä»¶ã€‘</span>
    {% set query_params = [] %}
    {% for k, v in request.args.items() %}
      {% if k != 'page' and k != 'limit' and v %}
        {% set _ = query_params.append(k ~ '=' ~ v|urlencode) %}
      {% endif %}
    {% endfor %}
    {% set base_query = query_params|join('&') %}
    {% macro page_url(p) -%}
      {{ base_url }}?page={{ p }}&limit={{ selected_limit }}{% if base_query %}&{{ base_query }}{% endif %}
    {%- endmacro %}

    {# --- æœ€åˆ --- #}
    {% if page > 1 %}
      <a href="{{ page_url(1) }}" class="page-nav">æœ€åˆ</a>
    {% else %}
      <span class="page-nav" style="color:#ccc;">æœ€åˆ</span>
    {% endif %}

    {# --- å‰ã¸ --- #}
    {% if page > 1 %}
      <a href="{{ page_url(page - 1) }}" class="page-nav">å‰ã¸</a>
    {% else %}
      <span class="page-nav" style="color:#ccc;">å‰ã¸</span>
    {% endif %}

    {# --- æ•°å­—éƒ¨åˆ† --- #}
    {% set show_pages = [1, 2, 3] %}
    {% if total_pages < 3 %}
      {% set show_pages = range(1, total_pages + 1) %}
    {% elif page == 1 %}
      {% set show_pages = [1, 2, 3] %}
    {% elif page == total_pages and total_pages > 2 %}
      {% set show_pages = [total_pages - 2, total_pages - 1, total_pages] %}
    {% else %}
      {% set show_pages = [page - 1, page, page + 1] %}
    {% endif %}

    {% for p in show_pages %}
      {% if 1 <= p <= total_pages %}
        {% if p == page %}
          <strong>{{ p }}</strong>
        {% else %}
          <a href="{{ page_url(p) }}">{{ p }}</a>
        {% endif %}
      {% endif %}
    {% endfor %}

    {# --- æ¬¡ã¸ --- #}
    {% if page < total_pages %}
      <a href="{{ page_url(page + 1) }}" class="page-nav">æ¬¡ã¸</a>
    {% else %}
      <span class="page-nav" style="color:#ccc;">æ¬¡ã¸</span>
    {% endif %}

    {# --- æœ€å¾Œ --- #}
    {% if page < total_pages %}
      <a href="{{ page_url(total_pages) }}" class="page-nav">æœ€å¾Œ</a>
    {% else %}
      <span class="page-nav" style="color:#ccc;">æœ€å¾Œ</span>
    {% endif %}
  </div>

  {# ğŸ”¹ æ¤œç´¢ãƒœã‚¿ãƒ³ãƒ»ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ï¼ˆä¸­å¤®ï¼‰ #}
  <div class="search-buttons" style="text-align: center;">
    <button type="submit" class="btn-search">æ¤œç´¢</button>
    <button type="button" class="btn-clear" onclick="clearForm()">ã‚¯ãƒªã‚¢</button>
  </div>
  
  {# ğŸ”¹ è¡¨ç¤ºä»¶æ•°ã‚»ãƒ¬ã‚¯ãƒˆï¼ˆå³å¯„ã›ï¼‰ #}
  <div class="search-limit-wrapper" style="display: flex; align-items: center; gap: 4px;">
    <label class="search-label">è¡¨ç¤ºä»¶æ•°</label>
    <select name="limit" class="search-input select-limit" style="width: 60px;">
      {% for num in [20, 50, 100] %}
      <option value="{{ num }}" {% if selected_limit == num|string %}selected{% endif %}>{{ num }}</option>
      {% endfor %}
    </select>
  </div>

</div>
<script>
function clearForm() {
  const btn = event.target;
  const form = btn.closest('form');
  if (!form) return;
  // input, select, textareaã‚’ã™ã¹ã¦ç©ºã«
  form.querySelectorAll('input, select, textarea').forEach(el => {
    if (el.type === 'checkbox' || el.type === 'radio') {
      el.checked = false;
    } else if (el.tagName === 'SELECT') {
      el.selectedIndex = 0;
    } else {
      el.value = '';
    }
  });
}
</script>
{% endmacro %}